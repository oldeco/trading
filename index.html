<script>
  async function fetchPolygonData(symbol) {
    const proxy = "https://corsproxy.io/?"; // Temporary proxy
    const url = `${proxy}https://api.polygon.io/v2/aggs/ticker/${symbol}/range/1/minute/60/minute?adjusted=true&sort=desc&limit=20&apiKey=b9pUWqpiaRl96K9b2EOpNePWZ2TCiALB`;

    const res = await fetch(url);
    const json = await res.json();
    return json.results?.map(point => point.c).reverse() || [];
  }

  async function createChart(id, color, symbol) {
    const ctx = document.getElementById(id).getContext('2d');
    const prices = await fetchPolygonData(symbol);

    if (!prices.length) return;

    const gradient = ctx.createLinearGradient(0, 0, 0, 100);
    gradient.addColorStop(0, color + '33');
    gradient.addColorStop(1, color + '00');

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array(prices.length).fill(''),
        datasets: [{
          data: prices,
          borderColor: color,
          borderWidth: 2,
          tension: 0.4,
          pointRadius: 0,
          backgroundColor: gradient,
          fill: true
        }]
      },
      options: {
        plugins: {
          legend: { display: false },
          tooltip: { enabled: false }
        },
        scales: {
          x: { display: false },
          y: { display: false }
        },
        responsive: true,
        maintainAspectRatio: false
      }
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    createChart('qtChart', '#2962ff', 'AAPL');   // Apple
    createChart('mgenChart', '#00c853', 'MSFT'); // Microsoft
    createChart('gexChart', '#2962ff', 'TSLA');  // Tesla
    createChart('gscChart', '#ff3d00', 'AMZN');  // Amazon
  });
</script>
